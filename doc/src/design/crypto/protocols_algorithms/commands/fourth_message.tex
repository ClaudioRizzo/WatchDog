\paragraph{Fourth message}\hspace{0pt}\\
When m3 is received within the timeout (which is immediately stopped), the decryption (which includes the MAC integrity check) is performed, followed by the signature verification. After that, various actions are performed depending on the command received and m4 is constructed as  AES256GCM(key-for-m4, iv-for-m4, header + fixed length body with padding + ecdsa signature) and sent. Finally the log is updated and the preferences of the session deleted, so that a new session can begin. When m4 is received (within the immediately stopped timeout) and passes the usual decryption/validations steps, different actions are performed depending on what was the sent command and, after everything is done, the session preferences are deleted on this side too.